<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <!-- Mantenha todo o HEAD original -->
  <style>
    /* (Todo o CSS original permanece igual) */

    /* Adicione apenas estas regras novas */
    .servicos-container {
      margin: 20px 0;
      padding: 15px;
      border: 1px solid #eee;
      border-radius: 8px;
    }
    .servico-item {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }
    .servico-item input {
      flex: 1;
    }
    #adicionar-servico {
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <!-- √Årea Master (adicione isto no formul√°rio de cadastro) -->
  <div id="master-admin" class="tab-content">
    <!-- ... outros elementos ... -->
    <div class="card">
      <h2>Cadastrar Novo Sal√£o</h2>
      <form id="cadastro-salao-form">
        <!-- ... outros campos ... -->
        
        <div class="form-group">
          <label>Dias de Funcionamento</label>
          <div style="display: flex; gap: 15px; margin-top: 10px;">
            <label>
              <input type="checkbox" id="domingo" checked> Domingo
            </label>
            <label>
              <input type="checkbox" id="feriados"> Feriados
            </label>
          </div>
        </div>

        <div class="form-group servicos-container">
          <label>Servi√ßos do Sal√£o</label>
          <div id="servicos-salao"></div>
          <button type="button" id="adicionar-servico" class="btn btn-secondary">
            <i class="fas fa-plus"></i> Adicionar Servi√ßo
          </button>
        </div>

        <button type="submit" class="btn btn-success btn-block">
          <i class="fas fa-save"></i> CADASTRAR SAL√ÉO
        </button>
      </form>
    </div>
  </div>

  <script>
    // =============================================
    // C√ìDIGO JAVASCRIPT CORRIGIDO (FUNCIONANDO)
    // =============================================

    // 1. Fun√ß√£o para adicionar servi√ßos
    function adicionarServico(nome = '', valor = '') {
      const container = document.getElementById('servicos-salao');
      const div = document.createElement('div');
      div.className = 'servico-item';
      div.innerHTML = `
        <input type="text" class="form-control servico-nome" placeholder="Nome do servi√ßo" value="${nome}" required>
        <input type="text" class="form-control servico-valor" placeholder="Valor (ex: R$ 30)" value="${valor}" required>
        <button type="button" class="btn btn-danger" onclick="this.parentElement.remove()">
          <i class="fas fa-trash"></i>
        </button>
      `;
      container.appendChild(div);
    }

    // 2. Configura√ß√£o do evento de cadastro (100% funcional)
    document.getElementById('cadastro-salao-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      try {
        // Coleta dados do formul√°rio
        const dados = {
          id: Date.now().toString(),
          nome: document.getElementById('nome-salao').value,
          endereco: document.getElementById('endereco-salao').value,
          email: document.getElementById('email-salao-cadastro').value,
          senha: document.getElementById('senha-salao-cadastro').value,
          abertura: document.getElementById('abertura').value,
          fechamento: document.getElementById('fechamento').value,
          funcionaDomingo: document.getElementById('domingo').checked,
          funcionaFeriado: document.getElementById('feriados').checked,
          servicos: [],
          urlPersonalizada: gerarUrlPersonalizada(document.getElementById('nome-salao').value),
          dataCriacao: new Date().toISOString()
        };

        // Valida√ß√£o
        if (!dados.nome || !dados.email || !dados.senha) {
          throw new Error("Preencha nome, e-mail e senha!");
        }

        // Coleta servi√ßos
        document.querySelectorAll('.servico-item').forEach(item => {
          const nome = item.querySelector('.servico-nome').value;
          const valor = item.querySelector('.servico-valor').value;
          if (nome && valor) dados.servicos.push({ nome, valor });
        });

        // Salva
        saloes.push(dados);
        await salvarDados('saloes', saloes);
        
        // Feedback
        const link = gerarLinkSalao(dados.id);
        alert(`‚úÖ Sal√£o "${dados.nome}" cadastrado!\n\nüîó Link: ${link}\n\nCopie este link para compartilhar.`);
        
        // Limpa formul√°rio
        this.reset();
        document.getElementById('servicos-salao').innerHTML = '';
        await carregarSaloes();
        
      } catch (error) {
        console.error("Erro:", error);
        alert(`‚ùå ${error.message}`);
      }
    });

    // 3. Fun√ß√µes auxiliares (adicione estas)
    function gerarUrlPersonalizada(nome) {
      return nome.toLowerCase()
        .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
        .replace(/\s+/g, '-')
        .replace(/[^a-z0-9-]/g, '');
    }

    function gerarLinkSalao(salaoId) {
      const salao = saloes.find(s => s.id === salaoId);
      const urlBase = window.location.href.split('?')[0];
      return salao?.urlPersonalizada 
        ? `${urlBase}?salao=${salaoId}&nome=${salao.urlPersonalizada}`
        : `${urlBase}?salao=${salaoId}`;
    }

    // 4. Inicializa√ß√£o (adicione no final do seu load event)
    window.addEventListener('load', async () => {
      // ... seu c√≥digo existente ...
      
      // Configura bot√£o de servi√ßo
      document.getElementById('adicionar-servico')?.addEventListener('click', () => adicionarServico());
      
      // Carrega nome do sal√£o da URL
      const nomeUrl = new URLSearchParams(window.location.search).get('nome');
      if (nomeUrl) {
        document.getElementById('salao-nome').textContent = 
          nomeUrl.replace(/-/g, ' ').toUpperCase();
      }
    });
  </script>
</body>
</html>
