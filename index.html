<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <!-- Mantenha todo o HEAD original igual -->
  <style>
    /* Mantenha todo o CSS original */
    
    /* Adicione apenas estas novas regras */
    .servicos-container {
      margin-top: 20px;
      border: 1px solid #eee;
      padding: 15px;
      border-radius: 8px;
    }
    .servico-item {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }
    .servico-item input {
      flex: 1;
    }
    @media (max-width: 768px) {
      .servico-item {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <!-- Mantenha todo o HTML original -->

  <script>
    // =============================================
    // CONFIGURAÇÕES GLOBAIS (ATUALIZADAS)
    // =============================================
    const API_URL = 'http://localhost:3000';
    let useAPI = false;
    let db;
    let currentUser = null;
    let agendamentos = [];
    let saloes = [];

    // =============================================
    // FUNÇÕES NOVAS/ATUALIZADAS
    // =============================================

    // Gerar URL amigável (NOVO)
    function gerarUrlPersonalizada(nome) {
      return nome.toLowerCase()
        .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
        .replace(/\s+/g, '-')
        .replace(/[^a-z0-9-]/g, '');
    }

    // Gerar link do salão (ATUALIZADA)
    function gerarLinkSalao(salaoId) {
      const salao = saloes.find(s => s.id === salaoId);
      const urlBase = window.location.href.split('?')[0];
      return salao?.urlPersonalizada 
        ? `${urlBase}?salao=${salaoId}&nome=${salao.urlPersonalizada}`
        : `${urlBase}?salao=${salaoId}`;
    }

    // Adicionar serviço (NOVO)
    function adicionarServico(nome = '', valor = '') {
      const container = document.getElementById('servicos-salao');
      const div = document.createElement('div');
      div.className = 'servico-item';
      div.innerHTML = `
        <input type="text" class="form-control servico-nome" placeholder="Nome do serviço" value="${nome}">
        <input type="text" class="form-control servico-valor" placeholder="Valor (ex: R$ 30,00)" value="${valor}">
        <button type="button" class="btn btn-danger" onclick="this.parentElement.remove()">
          <i class="fas fa-trash"></i>
        </button>
      `;
      container.appendChild(div);
    }

    // Cadastro de salão (ATUALIZADA)
    async function cadastrarSalao(e) {
      e.preventDefault();
      
      try {
        const nome = document.getElementById('nome-salao').value;
        if (!nome) throw new Error("Nome do salão é obrigatório!");

        const novoSalao = {
          id: Date.now().toString(),
          nome,
          endereco: document.getElementById('endereco-salao').value,
          email: document.getElementById('email-salao-cadastro').value,
          senha: document.getElementById('senha-salao-cadastro').value,
          abertura: document.getElementById('abertura').value,
          fechamento: document.getElementById('fechamento').value,
          horario: `${document.getElementById('abertura').value} - ${document.getElementById('fechamento').value}`,
          funcionaDomingo: document.getElementById('domingo').checked,
          funcionaFeriado: document.getElementById('feriados').checked,
          servicos: Array.from(document.querySelectorAll('.servico-item'))
            .map(item => ({
              nome: item.querySelector('.servico-nome').value,
              valor: item.querySelector('.servico-valor').value
            }))
            .filter(s => s.nome && s.valor),
          urlPersonalizada: gerarUrlPersonalizada(nome),
          dataCriacao: new Date().toISOString()
        };

        // Validação
        if (!novoSalao.email || !novoSalao.senha) {
          throw new Error("E-mail e senha são obrigatórios!");
        }

        // Salva
        saloes.push(novoSalao);
        await salvarDados('saloes', saloes);
        
        // Feedback
        const link = gerarLinkSalao(novoSalao.id);
        alert(`Salão cadastrado com sucesso!\n\nLink: ${link}\n\nCopie este link para compartilhar.`);
        
        // Limpa formulário
        e.target.reset();
        document.getElementById('servicos-salao').innerHTML = '';
        await carregarSaloes();
        
      } catch (error) {
        console.error("Erro no cadastro:", error);
        alert(error.message || "Erro ao cadastrar salão. Verifique o console (F12).");
      }
    }

    // =============================================
    // MODIFICAÇÕES NO HTML (ADICIONE ESTES ELEMENTOS)
    // =============================================
    /*
    NO FORMULÁRIO DE CADASTRO DE SALÃO, ADICIONE:
    
    <div class="form-group">
      <label>Dias de Funcionamento</label>
      <div style="display: flex; gap: 15px; margin-top: 10px;">
        <label>
          <input type="checkbox" id="domingo" checked> Domingo
        </label>
        <label>
          <input type="checkbox" id="feriados"> Feriados
        </label>
      </div>
    </div>

    <div class="form-group servicos-container">
      <label>Serviços do Salão</label>
      <div id="servicos-salao"></div>
      <button type="button" class="btn btn-secondary" onclick="adicionarServico()" style="margin-top: 10px;">
        <i class="fas fa-plus"></i> Adicionar Serviço
      </button>
    </div>
    */

    // =============================================
    // INICIALIZAÇÃO (ATUALIZADA)
    // =============================================
    window.addEventListener('load', async () => {
      // Configura eventos
      document.getElementById('cadastro-salao-form')?.addEventListener('submit', cadastrarSalao);
      
      // Adiciona botão de serviço
      const btnServico = document.createElement('button');
      btnServico.type = 'button';
      btnServico.className = 'btn btn-secondary';
      btnServico.innerHTML = '<i class="fas fa-plus"></i> Adicionar Serviço';
      btnServico.onclick = () => adicionarServico();
      document.querySelector('.servicos-container')?.appendChild(btnServico);

      // Carrega dados
      await initDB();
      saloes = await carregarDados('saloes');
      agendamentos = await carregarDados('agendamentos');

      // Personaliza título se houver parâmetro na URL
      const nomeSalao = new URLSearchParams(window.location.search).get('nome');
      if (nomeSalao) {
        document.getElementById('salao-nome').textContent = 
          nomeSalao.replace(/-/g, ' ').toUpperCase();
      }

      // (Mantenha o resto da inicialização original)
    });

    // =============================================
    // MANTENHA TODAS AS OUTRAS FUNÇÕES ORIGINAIS
    // =============================================
    // (initDB, salvarDados, carregarDados, etc)
  </script>
</body>
</html>
